generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(uuid())
  email           String           @unique
  name            String
  username        String           @unique
  password        String
  confirme_code   String?
  avatar          String?
  roleUser        roleUser         @default(user)
  github_token    String?
  github_username String?
  github_id       String?
  provider        Provider?        @default(local)
  is_active       Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  workspaces      User_workspace[]
  projects        project[]
  notifications   notification[]
  payments        payment[]
}

model User_workspace {
  id          String             @id @default(uuid())
  userId      String
  workspaceId String
  role        roleWorkspace?     @default(member)
  status      statusSolicitation @default(pending)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  User        User               @relation(fields: [userId], references: [id])
  Workspace   Workspace          @relation(fields: [workspaceId], references: [id])
}

model Workspace {
  id           String           @id @default(uuid())
  name         String
  max_projects Int              @default(10)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  users        User_workspace[]
  projects     project[]
}

model project {
  id           String      @id @default(uuid())
  domain       String      @unique
  name         String
  branch       String      @default("main")
  repo_url     String      @default("")
  description  String?
  workspaceId  String
  port         String      @default("3000")
  build_cmd    String?
  clone        cloneStatus @default(cloning)
  run_status   runStatus   @default(stoped)
  start_cmd    String?
  tecnology    tecnology?  @default(docker)
  userId       String
  environments String[]    @default([])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  payments     payment[]
  deploy       deploy[]

  Workspace Workspace @relation(fields: [workspaceId], references: [id])
  User      User      @relation(fields: [userId], references: [id])
}

model deploy {
  id        String    @id @default(uuid())
  projectId String
  status    runStatus @default(building)
  success   Boolean   @default(true)
  logs      String[]  @default([])

  // dados do commit
  commit_id     String?
  commit_msg    String?
  commit_author String?
  commit_email  String?
  commit_date   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Project   project  @relation(fields: [projectId], references: [id])
}

model payment {
  id           String        @id @default(uuid())
  userId       String
  projectId    String
  date_start   DateTime?
  date_end     DateTime?
  time_in_day  Int?          @default(0)
  type_payment typePayment
  qty_months   Int
  amount       Float
  status       PaymentStatus @default(pending)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  project      project       @relation(fields: [projectId], references: [id])
  User         User          @relation(fields: [userId], references: [id])
}

model notification {
  id        String   @id @default(uuid())
  userId    String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id])
}

enum Provider {
  local
  github
  google
}

enum PaymentStatus {
  pending
  completed
  failed
}

enum statusSolicitation {
  pending
  approved
  rejected
}

enum roleWorkspace {
  master
  member
}

enum typePayment {
  daily
  monthly
  yearly
}

enum roleUser {
  admin
  user
}

enum tecnology {
  nodejs
  docker
}

enum cloneStatus {
  cloning
  cloned
  failed
}

enum runStatus {
  building
  stoped
  running
  failed
}
